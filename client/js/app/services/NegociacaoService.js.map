{"version":3,"sources":["../../app-es6/services/NegociacaoService.js"],"names":["HttpService","ConnectionFactory","NegociacaoDao","Negociacao","NegociacaoService","_httpService","Promise","resolve","reject","all","obterNegociacaoDaSemana","obterNegociacaoDaSemanaAnterior","obterNegociacaoDaSemanaRetrasada","then","negociacoes","reduce","arrayReduzido","array","concat","catch","error","get","json","map","Date","item","data","quantidade","valor","console","log","negociacao","getConnection","connection","dao","adiciona","Error","listaTodos","apagaTodos","mensagem","listaAtual","obterNegociacoes","filter","some","JSON","stringify","negociacaoExistente"],"mappings":"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","file":"NegociacaoService.js","sourcesContent":["import { HttpService } from \"./HttpService\";\nimport { ConnectionFactory } from \"./ConnectionFactory\";\nimport { NegociacaoDao } from \"../dao/NegociacaoDao\";\nimport { Negociacao } from \"../model/Negociacao\";\n\nexport class NegociacaoService {\n\n    constructor() {\n        this._httpService = new HttpService();\n    }\n\n    obterNegociacoes() {\n\n        return new Promise((resolve, reject) => {\n\n            Promise.all([this.obterNegociacaoDaSemana(),\n            this.obterNegociacaoDaSemanaAnterior(),\n            this.obterNegociacaoDaSemanaRetrasada()])\n                .then(negociacoes => {\n                    resolve(negociacoes.reduce((arrayReduzido, array) => arrayReduzido.concat(array), []))\n                })\n                .catch(error => reject(error));\n        });\n    }\n\n    obterNegociacaoDaSemana() {\n\n        return new Promise((resolve, reject) => {\n            this._httpService.get('negociacoes/semana')\n                .then((json) => {\n                    resolve(json.map(item => new Negociacao(new Date(item.data), item.quantidade, item.valor)));\n                })\n                .catch(error => {\n                    console.log(error);\n                    reject('Nao foi possivel obter as negociacoes da semana.');\n                });\n        });\n    }\n\n    obterNegociacaoDaSemanaAnterior() {\n\n        return new Promise((resolve, reject) => {\n            this._httpService.get('negociacoes/anterior')\n                .then((json) => {\n                    resolve(json.map(item => new Negociacao(new Date(item.data), item.quantidade, item.valor)));\n                })\n                .catch(error => {\n                    console.log(error);\n                    reject('Nao foi possivel obter as negociacoes da semana anterior.');\n                });\n        });\n    }\n\n    obterNegociacaoDaSemanaRetrasada() {\n\n        return new Promise((resolve, reject) => {\n            this._httpService.get('negociacoes/retrasada')\n                .then((json) => {\n                    resolve(json.map(item => new Negociacao(new Date(item.data), item.quantidade, item.valor)));\n                })\n                .catch(error => {\n                    console.log(error);\n                    reject('Nao foi possivel obter as negociacoes da semana retrasada.');\n                });\n        });\n    }\n\n    cadastrar(negociacao) {\n\n        return ConnectionFactory.getConnection()\n            .then(connection => new NegociacaoDao(connection))\n            .then(dao => dao.adiciona(negociacao))\n            .then(() => 'Negociacao adicionada com sucesso.')\n            .catch((error) => {\n                console.log(error);\n                throw new Error('Nao foi possivel cadastrar a negociacao.')\n            });\n\n    }\n\n    lista() {\n\n        return ConnectionFactory.getConnection()\n            .then(connection => new NegociacaoDao(connection))\n            .then(dao => dao.listaTodos())\n            .then(negociacoes => negociacoes)\n            .catch((error) => {\n                console.log(error);\n                throw new Error('Nao foi possivel listar as negociacoes.')\n            });\n\n    }\n\n    apaga() {\n\n        return ConnectionFactory.getConnection()\n            .then(connection => new NegociacaoDao(connection))\n            .then(dao => dao.apagaTodos())\n            .then(mensagem => mensagem)\n            .catch((error) => {\n                console.log(error);\n                throw new Error('Nao foi possivel apagar as negociacoes.')\n            });\n    }\n\n    importa(listaAtual) {\n\n        return this.obterNegociacoes()\n            .then(negociacoes => negociacoes.filter(negociacao =>\n                !listaAtual.some(negociacaoExistente =>\n                    JSON.stringify(negociacao) == JSON.stringify(negociacaoExistente))))\n            .catch((error) => {\n                console.log(error);\n                throw new Error('Nao foi possivel listar as negociacoes.')\n            });\n    }\n\n}"]}