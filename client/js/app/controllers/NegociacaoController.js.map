{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["NegociacoesView","ListaNegociacoes","MensagemView","Mensagem","NegociacaoService","DateHelper","Negociacao","Bind","NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_negociacoesView","_listaNegociacoes","_mensagemView","_mensagem","_negociacaoService","_ordemAtual","_init","_consultaNegociacoes","setInterval","importaNegociacoes","event","preventDefault","negociacao","_criaNegociacao","cadastrar","then","adiciona","texto","mensagem","_limpaFormulario","catch","error","importa","negociacoes","forEach","textoParaData","value","parseInt","parseFloat","apaga","esvazia","msg","focus","lista","map","item","coluna","inverteOrdem","ordena","p","s","negociacaoController","currentInstance"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { NegociacoesView } from \"../views/NegociacoesView\";\nimport { ListaNegociacoes } from \"../model/ListaNegociacoes\";\nimport { MensagemView } from \"../views/MensagemView\";\nimport { Mensagem } from \"../model/Mensagem\";\nimport { NegociacaoService } from \"../services/NegociacaoService\";\nimport { DateHelper } from \"../helpers/DateHelper\";\nimport { Negociacao } from \"../model/Negociacao\";\nimport { Bind } from \"../helpers/Bind\";\n\n\nclass NegociacaoController {\n\n    constructor() {\n\n        let $ = document.querySelector.bind(document);\n        this._inputData = $('#data');\n        this._inputQuantidade = $('#quantidade');\n        this._inputValor = $('#valor');\n\n        this._negociacoesView = new NegociacoesView($('#negociacoesView'));\n        this._listaNegociacoes = new Bind(new ListaNegociacoes(), this._negociacoesView, 'adiciona', 'esvazia', 'ordena', 'inverteOrdem');\n\n        this._mensagemView = new MensagemView($('#mensagemView'));\n        this._mensagem = new Bind(new Mensagem(), this._mensagemView, 'texto')\n\n        this._negociacaoService = new NegociacaoService();\n\n        this._ordemAtual = ''\n\n        this._init();\n    }\n\n    _init() {\n\n        this._consultaNegociacoes();\n        setInterval(() => this.importaNegociacoes(), 60000);\n    }\n\n    adiciona(event) {\n\n        event.preventDefault();\n\n        let negociacao = this._criaNegociacao();\n\n        this._negociacaoService.cadastrar(negociacao)\n            .then(mensagem => {\n                this._listaNegociacoes.adiciona(negociacao);\n                this._mensagem.texto = mensagem;\n                this._limpaFormulario();\n            })\n            .catch(error => this._mensagem.texto = error);\n        //this._consultaNegociacoes();       \n    }\n\n    importaNegociacoes() {\n\n        this._negociacaoService.importa(this._listaNegociacoes.negociacoes)\n            .then(negociacoes => {\n                negociacoes.forEach(negociacao => {\n                    this._listaNegociacoes.adiciona(negociacao);\n                    this._mensagem.texto = 'Negociacoes do periodo Importada';\n                });\n            })\n            .catch(error => this._mensagem.texto = error);\n    }\n\n    _criaNegociacao() {\n\n        return new Negociacao(DateHelper.textoParaData(this._inputData.value),\n            parseInt(this._inputQuantidade.value),\n            parseFloat(this._inputValor.value));\n    }\n\n    apaga() {\n\n        this._negociacaoService.apaga()\n            .then(msg => {\n                this._listaNegociacoes.esvazia();\n                this._mensagem.texto = msg;\n            })\n            .catch(error => this._mensagem.texto = error)\n    }\n\n    _limpaFormulario() {\n\n        this._inputData.value = '';\n        this._inputQuantidade.value = 1;\n        this._inputValor.value = 0.0;\n        this._inputData.focus();\n    }\n\n    _consultaNegociacoes() {\n\n        this._negociacaoService.lista()\n            .then(negociacoes => negociacoes.map(item => this._listaNegociacoes.adiciona(item)))\n            .catch(error => this._mensagem = error)\n\n    }\n\n    ordena(coluna) {\n        \n        if(this._ordemAtual == coluna) {            \n\n            this._listaNegociacoes.inverteOrdem(); \n        } else {            \n            \n            this._listaNegociacoes.ordena((p, s) => p[coluna] - s[coluna]);    \n        }\n        this._ordemAtual = coluna;    \n    }\n}\n\nlet negociacaoController = new NegociacaoController();\n\nexport function currentInstance(){\n    return negociacaoController;\n}"]}